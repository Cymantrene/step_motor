// ===================== potentiometer.h =====================
// Модуль чтения потенциометра через ADC
// -----------------------------------------------------------
// Назначение:
// - аккуратное чтение аналогового сигнала (потенциометр)
// - программная фильтрация без рывков
// - отсутствие прерываний и DMA (простота и надежность)
//
// Использование:
// 1. Настроить ADC в CubeMX (1 канал, single-ended)
// 2. В main.c вызвать Potentiometer_Init()
// 3. В while(1) периодически вызывать Potentiometer_Update()
// 4. Получать значение через Potentiometer_GetValue()
// -----------------------------------------------------------

#ifndef POTENTIOMETER_H
#define POTENTIOMETER_H

#include "stm32g4xx_hal.h"
#include <stdint.h>

// Структура потенциометра
// Хранит все данные, связанные с ADC и фильтрацией
typedef struct {
	ADC_HandleTypeDef *hadc; // указатель на ADC (ADC1 / ADC2)

	uint16_t raw; // последнее «сырое» значение ADC
	uint16_t filtered; // отфильтрованное значение

	uint16_t min; // минимальное допустимое значение
	uint16_t max; // максимальное допустимое значение

} Potentiometer;

// -----------------------------------------------------------
// Инициализация потенциометра
// -----------------------------------------------------------
// p – указатель на структуру Potentiometer
// hadc – указатель на ADC_HandleTypeDef (например &hadc2)
// min – минимальное значение (обычно 0)
// max – максимальное значение (обычно 4095 для 12 бит)
// -----------------------------------------------------------
void Potentiometer_Init(Potentiometer *p, ADC_HandleTypeDef *hadc, uint16_t min,
		uint16_t max);

// -----------------------------------------------------------
// Обновление значения потенциометра
// -----------------------------------------------------------
// Функцию нужно вызывать периодически (например в while(1))
// Неблокирующая, работает через PollForConversion
// -----------------------------------------------------------
void Potentiometer_Update(Potentiometer *p);

// -----------------------------------------------------------
// Получение отфильтрованного значения
// -----------------------------------------------------------
// Возвращает значение в диапазоне [min … max]
// -----------------------------------------------------------
uint16_t Potentiometer_GetValue(Potentiometer *p);

#endif
